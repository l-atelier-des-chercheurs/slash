import{n,_ as r}from"../build.js";import{D as h}from"./DynamicTitle-CpTdDlYg.js";const l={props:{},mixins:[h],components:{AdminSettings:()=>r(()=>import("./AdminSettings-BqfaQVEF.js"),[])},data(){return{author:void 0,is_loading:!0,fetch_author_error:!1,show_settings_modal:!1,group_suggestions:[]}},async created(){this.group_suggestions=await this.getAllAuthorsGroup()},async mounted(){this.$api.updateSelfPath(this.author_path),await this.listAuthor(),this.$api.join({room:this.author_path})},beforeDestroy(){this.$api.leave({room:this.author_path})},watch:{},computed:{author_path(){return this.createPath({author_slug:this.$route.params.author_slug})},is_self(){return this.connected_as&&this.author?this.connected_as.$path===this.author.$path:!1},is_connected(){return this.author?this.$api.other_devices_connected.some(e=>{var t;return((t=e.meta)==null?void 0:t.token_path)===this.author.$path}):!1},can_edit(){return this.is_self||this.is_instance_admin},author_has_location(){var e,t,a,i;return!!((t=(e=this.author)==null?void 0:e.$location)!=null&&t.latitude)&&!!((i=(a=this.author)==null?void 0:a.$location)!=null&&i.longitude)}},methods:{async listAuthor(){const e=await this.$api.getFolder({path:this.author_path}).catch(t=>{this.fetch_author_error=t.response,this.is_loading=!1});this.is_loading=!1,this.author=e,this.author&&this.updateDocumentTitle(this.author.name),this.$eventHub.$emit("received.author",this.author)},async removeAuthor(){await this.$api.deleteItem({path:this.author.$path}),this.$router.push("/@"),this.is_self&&(await this.$api.logoutFromFolder(),window.location.reload())},async getAllAuthorsGroup(){return(await this.$api.getFolders({path:"authors"})).reduce((t,a)=>{var i;return(i=a.group)==null||i.map(o=>{t.some(s=>s===o)||o&&t.push(o)}),t},[]).sort((t,a)=>t.localeCompare(a))}}};var _=function(){var t=this,a=t._self._c;return a("div",{staticClass:"_authorView"},[t.is_loading?a("div",{key:"loader",staticClass:"_spinner"},[a("LoaderSpinner")],1):[a("div",{staticClass:"_authorFull"},[a("div",{staticClass:"u-spacingBottom"},[a("router-link",{staticClass:"u-buttonLink",attrs:{to:"/@"}},[a("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("list_of_accounts"))+" ")],1)],1),a("div",{staticClass:"_topbar"},[a("div",{staticClass:"_cover"},[a("CoverField",{attrs:{context:"full",cover:t.author.$cover,title:t.$t("pick_portrait"),preview_format:"circle",ratio:"square",available_options:["import","capture"],path:t.author.$path,placeholder:t.author.name.substring(0,2),can_edit:t.can_edit}})],1),a("div",{staticClass:"_text"},[a("div",{},[a("TitleField",{attrs:{label:t.$t("name_or_pseudonym"),show_label:!1,field_name:"name",content:t.author.name,path:t.author.$path,required:!0,minlength:3,maxlength:40,tag:"h1",can_edit:t.can_edit}}),t.authorIsInstance({field:"$admins",folder_path:t.author.$path})?a("div",{staticClass:"u-instructions"},[a("small",[a("b-icon",{attrs:{icon:"shield-check","aria-label":t.$t("admin")}}),t._v(" "+t._s(t.$t("admin"))+" ")],1)]):t._e(),t.is_connected&&!t.is_self?a("div",{staticClass:"_connected"},[a("b-icon",{attrs:{title:t.$t("connected_currently"),icon:"people-fill"}}),t._v(" "+t._s(t.$t("connected_currently"))+" ")],1):t._e()],1),t.author.group||t.can_edit?a("div",[a("TagsField",{attrs:{label:t.$t("group"),field_name:"group",tag_type:"accountgroup",local_suggestions:t.group_suggestions,content:t.author.group,path:t.author.$path,can_edit:t.can_edit}})],1):t._e(),t.can_edit?a("div",{},[a("TitleField",{attrs:{label:t.$t("email"),show_label:!0,field_name:"email",content:t.author.email,path:t.author.$path,required:t.$root.app_infos.instance_meta.require_mail_to_signup,input_type:"email",autocomplete:"email",instructions:t.$t("email_instr"),can_edit:t.can_edit}})],1):t._e(),t.can_edit||t.author.presentation?a("div",[a("TitleField",{attrs:{label:t.$t("presentation"),field_name:"presentation",path:t.author.$path,content:t.author.presentation,input_type:"editor",custom_formats:["bold","italic","link","emoji"],can_edit:t.can_edit}})],1):t._e()]),t.can_edit||t.author.$location?a("DetailsPane",{staticClass:"u-spacingBottom",attrs:{header:t.$t("location"),is_open_initially:!0,has_items:t.author_has_location,icon:"map"}},[a("PositionPicker",{attrs:{field_name:"$location",content:t.author.$location,path:t.author.$path,can_edit:t.can_edit}})],1):t._e(),t.can_edit?a("DetailsPane",{attrs:{header:t.$t("options"),icon:"gear"}},[t.is_instance_admin&&!t.authorIsInstance({field:"$admins",folder_path:t.author.$path})?a("div",{staticClass:"u-spacingBottom"},[a("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){t.show_settings_modal=!0}}},[t._v(" "+t._s(t.$t("add_to_instance_admin"))+" ")]),t.show_settings_modal?a("AdminSettings",{attrs:{starting_tab:"administration_and_access_control"},on:{close:function(i){t.show_settings_modal=!1}}}):t._e()],1):t._e(),a("div",{staticClass:"u-spacingBottom"},[a("TitleField",{attrs:{label:t.$t("password"),field_name:"$password",content:"",path:t.author.$path,required:!0,minlength:3,maxlength:20,input_type:"password",can_edit:t.can_edit}})],1),a("div",{},[a("RemoveMenu",{attrs:{button_text:t.$t("remove_account"),modal_title:t.$t("remove_account_name",{name:t.author.name}),modal_expl:t.$t("remove_account_expl")},on:{remove:t.removeAuthor}})],1)]):t._e()],1)])]],2)},u=[],c=n(l,_,u,!1,null,"36d6c348");const m=c.exports;export{m as default};
