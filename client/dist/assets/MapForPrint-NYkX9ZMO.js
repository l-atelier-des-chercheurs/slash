import P from"./DisplayOnMap-h9gM8lWM.js";import{S as $}from"./SectionsList-CfCg1MKH.js";import{n as h}from"../build.js";import{M}from"./ModuleCreator-DSpQPBdW.js";import"./PublicationModule-D1KMDpcH.js";import"./CaptionCreditsPage-DdRviFVp.js";var k=Object.defineProperty,C=Object.defineProperties,O=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,g=(t,e,i)=>e in t?k(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,E=(t,e)=>{for(var i in e||(e={}))y.call(e,i)&&g(t,i,e[i]);if(m)for(var i of m(e))S.call(e,i)&&g(t,i,e[i]);return t},D=(t,e)=>C(t,O(e)),R=(t,e)=>{var i={};for(var n in t)y.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(t!=null&&m)for(var n of m(t))e.indexOf(n)<0&&S.call(t,n)&&(i[n]=t[n]);return i};function x(t,e,i,n,s,a,o,l){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=i,r._compiled=!0);var d;if(s&&(d=s),d)if(r.functional){r._injectStyles=d;var c=r.render;r.render=function(u,_){return d.call(_),c(u,_)}}else{var p=r.beforeCreate;r.beforeCreate=p?[].concat(p,d):[d]}return{exports:t,options:r}}const N={name:"splitpanes",props:{horizontal:{type:Boolean},pushOtherPanes:{type:Boolean,default:!0},dblClickSplitter:{type:Boolean,default:!0},rtl:{type:Boolean,default:!1},firstSplitter:{type:Boolean}},provide(){return{requestUpdate:this.requestUpdate,onPaneAdd:this.onPaneAdd,onPaneRemove:this.onPaneRemove,onPaneClick:this.onPaneClick}},data:()=>({container:null,ready:!1,panes:[],touch:{mouseDown:!1,dragging:!1,activeSplitter:null},splitterTaps:{splitter:null,timeoutId:null}}),computed:{panesCount(){return this.panes.length},indexedPanes(){return this.panes.reduce((t,e)=>(t[e.id]=e)&&t,{})}},methods:{updatePaneComponents(){this.panes.forEach(t=>{t.update&&t.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[t.id].size}%`})})},bindEvents(){document.addEventListener("mousemove",this.onMouseMove,{passive:!1}),document.addEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.addEventListener("touchmove",this.onMouseMove,{passive:!1}),document.addEventListener("touchend",this.onMouseUp))},unbindEvents(){document.removeEventListener("mousemove",this.onMouseMove,{passive:!1}),document.removeEventListener("mouseup",this.onMouseUp),"ontouchstart"in window&&(document.removeEventListener("touchmove",this.onMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onMouseUp))},onMouseDown(t,e){this.bindEvents(),this.touch.mouseDown=!0,this.touch.activeSplitter=e},onMouseMove(t){this.touch.mouseDown&&(t.preventDefault(),this.touch.dragging=!0,this.calculatePanesSize(this.getCurrentMouseDrag(t)),this.$emit("resize",this.panes.map(e=>({min:e.min,max:e.max,size:e.size}))))},onMouseUp(){this.touch.dragging&&this.$emit("resized",this.panes.map(t=>({min:t.min,max:t.max,size:t.size}))),this.touch.mouseDown=!1,setTimeout(()=>{this.touch.dragging=!1,this.unbindEvents()},100)},onSplitterClick(t,e){"ontouchstart"in window&&(t.preventDefault(),this.dblClickSplitter&&(this.splitterTaps.splitter===e?(clearTimeout(this.splitterTaps.timeoutId),this.splitterTaps.timeoutId=null,this.onSplitterDblClick(t,e),this.splitterTaps.splitter=null):(this.splitterTaps.splitter=e,this.splitterTaps.timeoutId=setTimeout(()=>{this.splitterTaps.splitter=null},500)))),this.touch.dragging||this.$emit("splitter-click",this.panes[e])},onSplitterDblClick(t,e){let i=0;this.panes=this.panes.map((n,s)=>(n.size=s===e?n.max:n.min,s!==e&&(i+=n.min),n)),this.panes[e].size-=i,this.$emit("pane-maximize",this.panes[e])},onPaneClick(t,e){this.$emit("pane-click",this.indexedPanes[e])},getCurrentMouseDrag(t){const e=this.container.getBoundingClientRect(),{clientX:i,clientY:n}="ontouchstart"in window&&t.touches?t.touches[0]:t;return{x:i-e.left,y:n-e.top}},getCurrentDragPercentage(t){t=t[this.horizontal?"y":"x"];const e=this.container[this.horizontal?"clientHeight":"clientWidth"];return this.rtl&&!this.horizontal&&(t=e-t),t*100/e},calculatePanesSize(t){const e=this.touch.activeSplitter;let i={prevPanesSize:this.sumPrevPanesSize(e),nextPanesSize:this.sumNextPanesSize(e),prevReachedMinPanes:0,nextReachedMinPanes:0};const n=0+(this.pushOtherPanes?0:i.prevPanesSize),s=100-(this.pushOtherPanes?0:i.nextPanesSize),a=Math.max(Math.min(this.getCurrentDragPercentage(t),s),n);let o=[e,e+1],l=this.panes[o[0]]||null,r=this.panes[o[1]]||null;const d=l.max<100&&a>=l.max+i.prevPanesSize,c=r.max<100&&a<=100-(r.max+this.sumNextPanesSize(e+1));if(d||c){d?(l.size=l.max,r.size=Math.max(100-l.max-i.prevPanesSize-i.nextPanesSize,0)):(l.size=Math.max(100-r.max-i.prevPanesSize-this.sumNextPanesSize(e+1),0),r.size=r.max);return}if(this.pushOtherPanes){const p=this.doPushOtherPanes(i,a);if(!p)return;({sums:i,panesToResize:o}=p),l=this.panes[o[0]]||null,r=this.panes[o[1]]||null}l!==null&&(l.size=Math.min(Math.max(a-i.prevPanesSize-i.prevReachedMinPanes,l.min),l.max)),r!==null&&(r.size=Math.min(Math.max(100-a-i.nextPanesSize-i.nextReachedMinPanes,r.min),r.max))},doPushOtherPanes(t,e){const i=this.touch.activeSplitter,n=[i,i+1];return e<t.prevPanesSize+this.panes[n[0]].min&&(n[0]=this.findPrevExpandedPane(i).index,t.prevReachedMinPanes=0,n[0]<i&&this.panes.forEach((s,a)=>{a>n[0]&&a<=i&&(s.size=s.min,t.prevReachedMinPanes+=s.min)}),t.prevPanesSize=this.sumPrevPanesSize(n[0]),n[0]===void 0)?(t.prevReachedMinPanes=0,this.panes[0].size=this.panes[0].min,this.panes.forEach((s,a)=>{a>0&&a<=i&&(s.size=s.min,t.prevReachedMinPanes+=s.min)}),this.panes[n[1]].size=100-t.prevReachedMinPanes-this.panes[0].min-t.prevPanesSize-t.nextPanesSize,null):e>100-t.nextPanesSize-this.panes[n[1]].min&&(n[1]=this.findNextExpandedPane(i).index,t.nextReachedMinPanes=0,n[1]>i+1&&this.panes.forEach((s,a)=>{a>i&&a<n[1]&&(s.size=s.min,t.nextReachedMinPanes+=s.min)}),t.nextPanesSize=this.sumNextPanesSize(n[1]-1),n[1]===void 0)?(t.nextReachedMinPanes=0,this.panes[this.panesCount-1].size=this.panes[this.panesCount-1].min,this.panes.forEach((s,a)=>{a<this.panesCount-1&&a>=i+1&&(s.size=s.min,t.nextReachedMinPanes+=s.min)}),this.panes[n[0]].size=100-t.prevPanesSize-t.nextReachedMinPanes-this.panes[this.panesCount-1].min-t.nextPanesSize,null):{sums:t,panesToResize:n}},sumPrevPanesSize(t){return this.panes.reduce((e,i,n)=>e+(n<t?i.size:0),0)},sumNextPanesSize(t){return this.panes.reduce((e,i,n)=>e+(n>t+1?i.size:0),0)},findPrevExpandedPane(t){return[...this.panes].reverse().find(i=>i.index<t&&i.size>i.min)||{}},findNextExpandedPane(t){return this.panes.find(i=>i.index>t+1&&i.size>i.min)||{}},checkSplitpanesNodes(){Array.from(this.container.children).forEach(e=>{const i=e.classList.contains("splitpanes__pane"),n=e.classList.contains("splitpanes__splitter");if(!i&&!n){e.parentNode.removeChild(e),console.warn("Splitpanes: Only <pane> elements are allowed at the root of <splitpanes>. One of your DOM nodes was removed.");return}})},addSplitter(t,e,i=!1){const n=t-1,s=document.createElement("div");s.classList.add("splitpanes__splitter"),i||(s.onmousedown=a=>this.onMouseDown(a,n),typeof window<"u"&&"ontouchstart"in window&&(s.ontouchstart=a=>this.onMouseDown(a,n)),s.onclick=a=>this.onSplitterClick(a,n+1)),this.dblClickSplitter&&(s.ondblclick=a=>this.onSplitterDblClick(a,n+1)),e.parentNode.insertBefore(s,e)},removeSplitter(t){t.onmousedown=void 0,t.onclick=void 0,t.ondblclick=void 0,t.parentNode.removeChild(t)},redoSplitters(){const t=Array.from(this.container.children);t.forEach(i=>{i.className.includes("splitpanes__splitter")&&this.removeSplitter(i)});let e=0;t.forEach(i=>{i.className.includes("splitpanes__pane")&&(!e&&this.firstSplitter?this.addSplitter(e,i,!0):e&&this.addSplitter(e,i),e++)})},requestUpdate(t){var e=t,{target:i}=e,n=R(e,["target"]);const s=this.indexedPanes[i._uid];Object.entries(n).forEach(([a,o])=>s[a]=o)},onPaneAdd(t){let e=-1;Array.from(t.$el.parentNode.children).some(s=>(s.className.includes("splitpanes__pane")&&e++,s===t.$el));const i=parseFloat(t.minSize),n=parseFloat(t.maxSize);this.panes.splice(e,0,{id:t._uid,index:e,min:isNaN(i)?0:i,max:isNaN(n)?100:n,size:t.size===null?null:parseFloat(t.size),givenSize:t.size,update:t.update}),this.panes.forEach((s,a)=>s.index=a),this.ready&&this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({addedPane:this.panes[e]}),this.$emit("pane-add",{index:e,panes:this.panes.map(s=>({min:s.min,max:s.max,size:s.size}))})})},onPaneRemove(t){const e=this.panes.findIndex(n=>n.id===t._uid),i=this.panes.splice(e,1)[0];this.panes.forEach((n,s)=>n.index=s),this.$nextTick(()=>{this.redoSplitters(),this.resetPaneSizes({removedPane:D(E({},i),{index:e})}),this.$emit("pane-remove",{removed:i,panes:this.panes.map(n=>({min:n.min,max:n.max,size:n.size}))})})},resetPaneSizes(t={}){!t.addedPane&&!t.removedPane?this.initialPanesSizing():this.panes.some(e=>e.givenSize!==null||e.min||e.max<100)?this.equalizeAfterAddOrRemove(t):this.equalize(),this.ready&&this.$emit("resized",this.panes.map(e=>({min:e.min,max:e.max,size:e.size})))},equalize(){const t=100/this.panesCount;let e=0,i=[],n=[];this.panes.forEach(s=>{s.size=Math.max(Math.min(t,s.max),s.min),e-=s.size,s.size>=s.max&&i.push(s.id),s.size<=s.min&&n.push(s.id)}),e>.1&&this.readjustSizes(e,i,n)},initialPanesSizing(){100/this.panesCount;let t=100,e=[],i=[],n=0;this.panes.forEach(a=>{t-=a.size,a.size!==null&&n++,a.size>=a.max&&e.push(a.id),a.size<=a.min&&i.push(a.id)});let s=100;t>.1&&(this.panes.forEach(a=>{a.size===null&&(a.size=Math.max(Math.min(t/(this.panesCount-n),a.max),a.min)),s-=a.size}),s>.1&&this.readjustSizes(t,e,i))},equalizeAfterAddOrRemove({addedPane:t,removedPane:e}={}){let i=100/this.panesCount,n=0,s=[],a=[];t&&t.givenSize!==null&&(i=(100-t.givenSize)/(this.panesCount-1)),this.panes.forEach(o=>{n-=o.size,o.size>=o.max&&s.push(o.id),o.size<=o.min&&a.push(o.id)}),!(Math.abs(n)<.1)&&(this.panes.forEach(o=>{t&&t.givenSize!==null&&t.id===o.id||(o.size=Math.max(Math.min(i,o.max),o.min)),n-=o.size,o.size>=o.max&&s.push(o.id),o.size<=o.min&&a.push(o.id)}),n>.1&&this.readjustSizes(n,s,a))},readjustSizes(t,e,i){let n;t>0?n=t/(this.panesCount-e.length):n=t/(this.panesCount-i.length),this.panes.forEach((s,a)=>{if(t>0&&!e.includes(s.id)){const o=Math.max(Math.min(s.size+n,s.max),s.min),l=o-s.size;t-=l,s.size=o}else if(!i.includes(s.id)){const o=Math.max(Math.min(s.size+n,s.max),s.min),l=o-s.size;t-=l,s.size=o}s.update({[this.horizontal?"height":"width"]:`${this.indexedPanes[s.id].size}%`})}),Math.abs(t)>.1&&this.$nextTick(()=>{this.ready&&console.warn("Splitpanes: Could not resize panes correctly due to their constraints.")})}},watch:{panes:{deep:!0,immediate:!1,handler(){this.updatePaneComponents()}},horizontal(){this.updatePaneComponents()},firstSplitter(){this.redoSplitters()},dblClickSplitter(t){[...this.container.querySelectorAll(".splitpanes__splitter")].forEach((i,n)=>{i.ondblclick=t?s=>this.onSplitterDblClick(s,n):void 0})}},beforeDestroy(){this.ready=!1},mounted(){this.container=this.$refs.container,this.checkSplitpanesNodes(),this.redoSplitters(),this.resetPaneSizes(),this.$emit("ready"),this.ready=!0},render(t){return t("div",{ref:"container",class:["splitpanes",`splitpanes--${this.horizontal?"horizontal":"vertical"}`,{"splitpanes--dragging":this.touch.dragging}]},this.$slots.default)}};let F,V;const b={};var B=x(N,F,V,!1,j);function j(t){for(let e in b)this[e]=b[e]}var T=function(){return B.exports}(),A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"splitpanes__pane",style:t.style,on:{click:function(n){return t.onPaneClick(n,t._uid)}}},[t._t("default")],2)},I=[];const L={name:"pane",inject:["requestUpdate","onPaneAdd","onPaneRemove","onPaneClick"],props:{size:{type:[Number,String],default:null},minSize:{type:[Number,String],default:0},maxSize:{type:[Number,String],default:100}},data:()=>({style:{}}),mounted(){this.onPaneAdd(this)},beforeDestroy(){this.onPaneRemove(this)},methods:{update(t){this.style=t}},computed:{sizeNumber(){return this.size||this.size===0?parseFloat(this.size):null},minSizeNumber(){return parseFloat(this.minSize)},maxSizeNumber(){return parseFloat(this.maxSize)}},watch:{sizeNumber(t){this.requestUpdate({target:this,size:t})},minSizeNumber(t){this.requestUpdate({target:this,min:t})},maxSizeNumber(t){this.requestUpdate({target:this,max:t})}}},z={};var q=x(L,A,I,!1,U);function U(t){for(let e in z)this[e]=z[e]}var G=function(){return q.exports}();const W={props:{publication:Object,pins:Array,opened_view_meta_filename:String,default_view_color:String,opened_pin_path:String,can_edit:Boolean},components:{SectionsList:$},provide(){return{$getMapOptions:()=>({opened_pin_path:this.opened_pin_path,pins_infos:this.pins.map(({path:t,index:e,color:i,pin_preview:n,pin_preview_src:s})=>({path:t,index:e,color:i,pin_preview:n,pin_preview_src:s})),default_view_color:this.default_view_color})}},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var H=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_viewPane"},[i("SectionsList",{attrs:{publication:e.publication,opened_section_meta_filename:e.opened_view_meta_filename,can_edit:e.can_edit},on:{toggleSection:function(n){return e.$emit("toggleView",n)}}})],1)},Q=[],X=h(W,H,Q,!1,null,"28357630");const Y=X.exports,Z={props:{title:String,context:{default:"preview",type:String},field_name:String,content:{type:String,default:""},open_modal_if_empty:Boolean,path:String,selected_media_path:String,media_type_to_pick:String},components:{},data(){return{show_media_picker:this.content?!1:this.open_modal_if_empty===!0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{selected_media(){const t=this.content;return t?this.getSourceMedia({source_media:{meta_filename_in_project:t},folder_path:this.selected_media_path||this.path}):!1}},methods:{async pickMedias(t){const e=t[0],i=this.getFilename(e.$path),n={[this.field_name]:i};return await this.$api.updateMeta({path:this.path,new_meta:n})}}};var J=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_singleBaseMediaPicker",attrs:{"data-context":e.context}},[i("div",{staticClass:"_mpContent"},[e.selected_media?i("MediaContent",{key:e.selected_media.$path,attrs:{file:e.selected_media,resolution:220,context:e.context},on:{videoPaused:function(n){return e.$emit("videoPaused")},videoEnded:function(n){return e.$emit("videoEnded")}}}):e.content?i("span",[e._v(" "+e._s(e.$t("media_not_found"))+" ")]):e._e(),i("div",{staticClass:"_changeBtn"},[e.content?i("button",{staticClass:"u-button u-button_small u-button_red",attrs:{type:"button"},on:{click:function(n){e.show_media_picker=!0}}},[i("b-icon",{attrs:{icon:"arrow-left-right"}}),e._v(" "+e._s(e.$t("change"))+" ")],1):i("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button"},on:{click:function(n){e.show_media_picker=!0}}},[i("b-icon",{attrs:{icon:"image"}}),e._v(" "+e._s(e.title)+" ")],1),e.show_media_picker?i("PickMediaFromProjects",{attrs:{title:e.title,path:e.path,select_mode:"single",pick_from_types:[e.media_type_to_pick]},on:{pickMedias:e.pickMedias,close:function(n){e.show_media_picker=!1}}}):e._e()],1),i("DropZone",{attrs:{media_types_allowed:e.media_type_to_pick?[e.media_type_to_pick]:void 0},on:{mediaDropped:function(n){return e.pickMedias([n])}}})],1)])},K=[],ee=h(Z,J,K,!1,null,"f34a294f");const te=ee.exports,ie={props:{view:Object,default_view_color:String},components:{SingleBaseMediaPicker:te},data(){return{icon_options:[{key:"",text:this.$t("icon")},{key:"media_preview",text:this.$t("media_preview")}],map_baselayer_options:[{key:"OSM",text:this.$t("OSM")},{key:"stadia_alidade_smooth",text:this.$t("alidade_smooth"),instructions:this.$t("provided_by_stadiamaps")},{key:"stadia_alidade_smooth_dark",text:this.$t("alidade_smooth_dark"),instructions:this.$t("provided_by_stadiamaps")},{key:"stadia_toner",text:this.$t("STAMEN_toner"),instructions:this.$t("provided_by_stadiamaps")},{key:"stadia_watercolor",text:this.$t("STAMEN_watercolor"),instructions:this.$t("provided_by_stadiamaps")},{key:"IGN_SAT",text:this.$t("IGN_SAT"),instructions:this.$t("IGN_max_zoom_limits")},{key:"IGN_MAP",text:this.$t("IGN_MAP"),instructions:this.$t("IGN_max_zoom_limits")},{key:"---",text:"---",disabled:!0},{key:"image",text:this.$t("image_or_drawing")},{key:"---2",text:"---",disabled:!0},{key:"color",text:this.$t("color")}]}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{map_mode(){var t;return((t=this.view)==null?void 0:t.map_mode)||"gps"},publication_path(){return this.getParent(this.view.$path)}},methods:{async updateView({field:t,value:e}){await this.$api.updateMeta({path:this.view.$path,new_meta:{[t]:e}})}}};var ne=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_viewOptions"},[i("div",{staticClass:"_viewOptions--content"},[i("DetailsPane",{staticClass:"_detailsInfo",attrs:{header:e.view.section_title,icon:"gear"}},[i("div",{staticClass:"u-spacingBottom"},[i("ColorInput",{attrs:{label:e.$t("pins_color"),can_toggle:!1,default_value:e.default_view_color,default_colors:["#b9b9b9","#ffffff","#B0BDED","#52c5b9","#ffbe32","#fc4b60"],value:e.view.section_color},on:{save:function(n){return e.updateView({field:"section_color",value:n})}}})],1),i("div",{staticClass:"u-spacingBottom"},[i("ToggleInput",{attrs:{label:e.$t("link_pins"),content:e.view.link_pins},on:{"update:content":function(n){return e.updateView({field:"link_pins",value:n})}}})],1),i("div",{staticClass:"u-spacingBottom"},[i("DLabel",{attrs:{str:e.$t("pin_icons")}}),i("SelectField2",{attrs:{field_name:"all_pins_icon",value:e.view.all_pins_icon||"",path:e.view.$path,options:e.icon_options,hide_validation:!0,can_edit:!0}})],1),i("div",{staticClass:"u-spacingBottom"},[i("DLabel",{attrs:{str:e.$t("map_baselayer")}}),i("SelectField2",{attrs:{field_name:"map_baselayer",path:e.view.$path,value:e.view.map_baselayer||"OSM",options:e.map_baselayer_options,hide_validation:!0,can_edit:!0}})],1),e.view.map_baselayer==="image"?i("div",{staticClass:"u-spacingBottom"},[i("DLabel",{attrs:{str:e.$t("image_basemap")}}),i("SingleBaseMediaPicker",{attrs:{title:e.$t("choose_image_basemap"),field_name:"map_base_media_filename",content:e.view.map_base_media_filename,path:e.view.$path,selected_media_path:e.publication_path,media_type_to_pick:"image"}})],1):e._e(),i("div",{staticClass:"u-spacingBottom"},[i("ColorInput",{attrs:{label:e.$t("background_color"),value:e.view.map_baselayer_color,default_value:"#F6F8F8"},on:{save:function(n){return e.updateView({field:"map_baselayer_color",value:n})}}})],1),i("div",{staticClass:"u-spacingBottom"},[i("RangeValueInput",{attrs:{label:e.$t("opacity"),value:e.view.map_baselayer_opacity,min:0,max:1,step:.01,default_value:1},on:{save:function(n){return e.updateView({field:"map_baselayer_opacity",value:n})}}})],1),i("div",{staticClass:"u-spacingBottom"},[i("ToggleInput",{attrs:{label:e.$t("bw_filter"),content:e.view.map_baselayer_bw},on:{"update:content":function(n){return e.updateView({field:"map_baselayer_bw",value:n})}}})],1)])],1)])},se=[],ae=h(ie,ne,se,!1,null,"1198c655");const oe=ae.exports,re={props:{publication:Object,opened_view_meta_filename:String,display:{type:String,default:"adjacent"},can_edit:Boolean},components:{Splitpanes:T,Pane:G,DisplayOnMap:P,ViewPane:Y,ViewOptions:oe,ModuleCreator:M},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{latest_click:{latitude:void 0,longitude:void 0},opened_pin_path:void 0,default_view_color:"#fc4b60",viewpane_visible:!0}},created(){},mounted(){},beforeDestroy(){},watch:{opened_view_meta_filename(){this.opened_pin_path=void 0},opened_pin_path(){if(this.opened_pin_path){const t=this.views.find(e=>{var i;return(i=e.modules_list)==null?void 0:i.includes(this.getFilename(this.opened_pin_path))});if(t){const e=this.getFilename(t.$path);this.opened_view_meta_filename!==e&&this.$emit("toggleView",e)}}}},computed:{views(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"})},opened_view(){return this.opened_view_meta_filename?this.views.find(t=>this.getFilename(t.$path)===this.opened_view_meta_filename):!1},base_media(){var e,i;if((e=this.opened_view)!=null&&e._map_base_media)return this.opened_view._map_base_media;const t=(i=this.opened_view)==null?void 0:i.map_base_media_filename;if(t)return this.getSourceMedia({source_media:{meta_filename_in_project:t},folder_path:this.publication.$path})},views_to_display(){return this.views.filter(t=>!this.opened_view_meta_filename||this.getFilename(t.$path)===this.opened_view_meta_filename)},pins(){return this.views_to_display.reduce((t,e)=>{const i=this.getModulesForSection({publication:this.publication,section:e}).map(({_module:s})=>s);let n=0;return i.map(s=>{var _,v;if(!((_=s.location)!=null&&_.longitude)||!((v=s.location)!=null&&v.latitude))return;let a=[];e.link_pins&&a.push(n+1),s.pin_name&&a.push(s.pin_name);const o=a.length>0?a.join(" â€¢ "):!1,l=this.getViewColor(e),r=s.zoom_level||"undefined";let d="icon";const c=`
              <svg enable-background="new 0 0 100 100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="30" height="30">
                <path
                  d="m78.527 5h-57.054c-4.104 0-7.431 3.324-7.431 7.428v57.059c0 4.106 3.326 7.433 7.431 7.433h11.965l16.501 18.08 16.5-18.085h12.088c4.104 0 7.431-3.322 7.431-7.429v-57.058c-.001-4.104-3.327-7.428-7.431-7.428z"
                  fill="${l}"
                  stroke="#000"
                  stroke-width="4px"
                />
                <text x="50" y="55" fill="#000000" text-anchor="middle" font-size="48px" font-weight="500" font-family="Fira Mono">
                  ${n+1}
                </text>
              </svg>`;let f=`data:image/svg+xml;base64, ${btoa(unescape(encodeURIComponent(c)))}`,u;if(e.all_pins_icon==="media_preview"){const w=this.getFirstThumbURLForMedia({file:this.firstMedia(s),resolution:50});w&&(d="media_preview",u=w)}t.push({longitude:s.location.longitude,latitude:s.location.latitude,label:o,index:n+1,path:s.$path,belongs_to_view:e.$path,link_pins:e.link_pins||!1,color:l,pin_zoom_level:r,pin_preview:d,pin_preview_src:f,first_media_thumb:u,file:this.firstMedia(s),module:s}),n++}),t},[])},lines(){return this.pins.length===0?{}:this.pins.reduce((t,e)=>{if(e.link_pins){const i=e.belongs_to_view;Object.prototype.hasOwnProperty.call(t,i)||(t[i]={color:e.color,coordinates:[]}),t[i].coordinates.push([e.longitude,e.latitude])}return t},{})},geometries(){return this.views_to_display.reduce((t,e)=>(!e.map_geom_features||!Array.isArray(e.map_geom_features)||e.map_geom_features.map(i=>{t.push(i)}),t),[])},new_module_meta(){return{location:{longitude:this.latest_click.longitude,latitude:this.latest_click.latitude}}},meta_filenames_already_present(){const{current:t,other:e}=this.getMediasAlreadyPresentInPublication({publication:this.publication,sections:this.views,opened_section_meta_filename:this.opened_view_meta_filename});return[{label:this.$t("in_this_section"),medias:t,color:"var(--c-orange)"},{label:this.$t("in_another_section"),medias:e,color:"var(--c-bleuvert)"}]}},methods:{newPositionClicked({longitude:t,latitude:e}){this.latest_click.longitude=t,this.latest_click.latitude=e},toggleView(t){this.$emit("toggleView",t)},getViewColor(t){return(t==null?void 0:t.section_color)||this.default_view_color},async addModules({meta_filenames:t}){await this.insertModuleMetaFilenamesToList2({publication:this.publication,section:this.opened_view,meta_filenames:t});const e=t.at(-1),i=this.publication.$path+"/"+e;setTimeout(()=>{this.$eventHub.$emit("publication.map.openPin",i),this.$eventHub.$emit(`module.enable_edit.${e}`)},150)},async updateOpenedView({field:t,value:e}){await this.$api.updateMeta({path:this.opened_view.$path,new_meta:{[t]:e}})},toggleViewpane(){this.viewpane_visible=!this.viewpane_visible}}};var le=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_mapView",attrs:{"data-display":e.display,"data-viewpane-hidden":!e.viewpane_visible}},[i(e.display==="adjacent"?"splitpanes":"div",{tag:"component"},[i(e.display==="adjacent"?"pane":"div",{tag:"component",attrs:{"min-size":"5"}},[i("div",{staticClass:"_mapContainerWrapper"},[i("DisplayOnMap",{key:e.opened_view_meta_filename,staticClass:"_mapContainer",attrs:{map_baselayer:e.opened_view?e.opened_view.map_baselayer:void 0,map_baselayer_bw:e.opened_view?e.opened_view.map_baselayer_bw:void 0,map_baselayer_opacity:e.opened_view?e.opened_view.map_baselayer_opacity:void 0,map_baselayer_color:e.opened_view?e.opened_view.map_baselayer_color:void 0,map_base_media:e.base_media,pins:e.pins,lines:e.lines,geometries:e.geometries,is_small:!1,opened_view_color:e.getViewColor(e.opened_view),opened_pin_path:e.opened_pin_path,can_edit:e.can_edit&&!!e.opened_view_meta_filename},on:{"update:opened_pin_path":function(n){e.opened_pin_path=n},newPositionClicked:e.newPositionClicked,saveGeom:function(n){return e.updateOpenedView({field:"map_geom_features",value:n})}}},[e.can_edit?i("div",{attrs:{slot:"popup_message"},slot:"popup_message"},[e.opened_view_meta_filename?i("div",[i("ModuleCreator",{attrs:{publication_path:e.publication.$path,start_collapsed:!1,select_mode:"single",types_available:["capture","import","write","embed","table"],post_addtl_meta:e.new_module_meta},on:{addModules:e.addModules}})],1):i("div",[e._v(" "+e._s(e.$t("to_add_media_here_open_matching_layer"))+" ")])]):e._e()]),i("button",{staticClass:"u-button u-button_icon _viewpaneToggle _navBtn",attrs:{title:e.viewpane_visible?e.$t("hide"):e.$t("show")},on:{click:e.toggleViewpane}},[i("b-icon",{attrs:{icon:e.viewpane_visible?"chevron-double-right":"chevron-double-left"}})],1)],1),i("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e.opened_view&&e.can_edit?i("ViewOptions",{key:e.opened_view.$path,attrs:{view:e.opened_view,default_view_color:e.default_view_color}}):e._e()],1)],1),i("transition",{attrs:{name:"viewpane-slide",mode:"out-in"}},[e.viewpane_visible?i(e.display==="adjacent"?"pane":"div",{tag:"component",attrs:{"min-size":"5"}},[i("ViewPane",{attrs:{publication:e.publication,opened_view_meta_filename:e.opened_view_meta_filename,default_view_color:e.default_view_color,opened_pin_path:e.opened_pin_path,pins:e.pins,can_edit:e.can_edit},on:{toggleView:e.toggleView,togglePin:function(n){e.opened_pin_path=n}}})],1):e._e()],1)],1)],1)},de=[],pe=h(re,le,de,!1,null,"34656de9");const ce=pe.exports,_e={props:{publication:Object},components:{MapView:ce},data(){return{display_mode:"all"}},created(){var t;(((t=this.$route.query)==null?void 0:t.display)==="section"||window.app_infos.page_is_standalone_html)&&(this.display_mode="section")},mounted(){},beforeDestroy(){},watch:{},computed:{opened_view_meta_filename(){var t;return((t=this.$route.query)==null?void 0:t.view)||void 0},views(){return this.getSectionsWithProps({publication:this.publication,group:"sections_list"})},openable_views_meta_filenames(){return this.views.map(t=>this.getFilename(t.$path))}},methods:{toggleView(t){t===this.opened_view_meta_filename&&(t=!1),this.updatePageQuery({prop:"view",val:t})}}};var he=function(){var e=this,i=e._self._c;return i("div",{staticClass:"_mapForPrint",attrs:{"data-display":e.display_mode}},[e.display_mode==="section"?[i("MapView",{staticClass:"_mapStoryContainer",attrs:{publication:e.publication,opened_view_meta_filename:e.opened_view_meta_filename,can_edit:!1},on:{toggleView:e.toggleView}})]:e._l(e.openable_views_meta_filenames,function(n){return i("div",{key:n,staticClass:"_mapStoryContainer"},[i("MapView",{attrs:{publication:e.publication,opened_view_meta_filename:n,can_edit:!1,display:"linear"},on:{toggleView:e.toggleView}})],1)})],2)},ue=[],me=h(_e,he,ue,!1,null,"8193e8d3");const ye=me.exports;export{ye as default};
