import{P as f}from"./PublicationSettings-DIeHMtor.js";import{W as v}from"./WidthHeightField-CIgRrgzN.js";import{n as _,I as b}from"../build.js";import{S as p}from"./SinglePage-CV6FPVua.js";import{M as $}from"./ModuleCreator-ihx-jm7Z.js";import{M as w,O as d,i as c,I as y,E as P,P as x}from"./infinite-viewer.esm-CmR3xtz1.js";import"./PublicationModule-dd2oAgB7.js";import"./MediaPicker-D4tDYCoF.js";import"./ResourcesPicker-B0s7t8Vv.js";import"./CaptionCreditsPage-DdRviFVp.js";import"./FlickityCarousel-BRYWTejq.js";const C={props:{publication:Object,is_spread:Boolean},components:{},data(){return{edit_mode:!1,is_saving:!1,can_edit:!0,top:this.publication.page_margin_top||0,bottom:this.publication.page_margin_bottom||0,left:this.publication.page_margin_left||0,right:this.publication.page_margin_right||0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{unit(){return this.publication.layout_mode==="screen"?"px":"mm"}},methods:{enableEditMode(){this.edit_mode=!0},cancel(){this.edit_mode=!1,this.is_saving=!1},async updateMargins(){this.is_saving=!0;try{const a={page_margin_top:this.top,page_margin_bottom:this.bottom,page_margin_left:this.left,page_margin_right:this.right};await this.$api.updateMeta({path:this.publication.$path,new_meta:a}),this.edit_mode=!1,this.is_saving=!1}catch(a){this.is_saving=!1,this.edit_mode=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(a.response.data)}}}};var M=function(){var e=this,t=e._self._c;return t("div",[t("fieldset",[t("legend",{staticClass:"u-label"},[e._v(e._s(e.$t("margins")))]),t("div",{staticClass:"u-instructions"},[t("small",[e._v(e._s(e.$t("margins_instructions")))])]),t("br"),e.can_edit&&!e.edit_mode?t("EditBtn",{attrs:{is_unfolded:!0},on:{click:e.enableEditMode}}):e._e(),t("br"),t("br"),t("div",{staticClass:"u-sameRow"},[t("div",{},[t("DLabel",{attrs:{str:e.$t("top")}}),t("div",{staticClass:"u-inputGroup"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.top,expression:"top",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.top},on:{input:function(i){i.target.composing||(e.top=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}}),t("span",{staticClass:"u-suffix",domProps:{textContent:e._s(e.unit)}})])],1),t("div",{},[t("DLabel",{attrs:{str:e.$t("bottom")}}),t("div",{staticClass:"u-inputGroup"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.bottom,expression:"bottom",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.bottom},on:{input:function(i){i.target.composing||(e.bottom=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}}),t("span",{staticClass:"u-suffix",domProps:{textContent:e._s(e.unit)}})])],1)]),t("br"),t("div",{staticClass:"u-sameRow"},[t("div",{},[t("DLabel",{attrs:{str:e.is_spread?e.$t("margins_inside"):e.$t("left")}}),t("div",{staticClass:"u-inputGroup"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.left,expression:"left",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.left},on:{input:function(i){i.target.composing||(e.left=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}}),t("span",{staticClass:"u-suffix",domProps:{textContent:e._s(e.unit)}})])],1),t("br"),t("div",{},[t("DLabel",{attrs:{str:e.is_spread?e.$t("margins_outside"):e.$t("right")}}),t("div",{staticClass:"u-inputGroup"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.right,expression:"right",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.right},on:{input:function(i){i.target.composing||(e.right=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}}),t("span",{staticClass:"u-suffix",domProps:{textContent:e._s(e.unit)}})])],1)]),e.edit_mode?t("div",{staticClass:"_footer"},[t("SaveCancelButtons",{staticClass:"_scb",attrs:{is_saving:e.is_saving},on:{save:e.updateMargins,cancel:e.cancel}})],1):e._e()],1)])},k=[],S=_(C,M,k,!1,null,"c63921a7");const z=S.exports,T={props:{publication:Object,is_spread:Boolean},components:{},data(){return{edit_mode:!1,is_saving:!1,can_edit:!0,enable_pagination:this.publication.enable_pagination||!1,pagn_starts_on_page:this.publication.pagn_starts_on_page||1,right:this.publication.pagn_right||10,bottom:this.publication.pagn_bottom||10}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{unit(){return this.publication.layout_mode==="screen"?"px":"mm"}},methods:{enableEditMode(){this.edit_mode=!0},cancel(){this.edit_mode=!1,this.is_saving=!1,this.enable_pagination=this.publication.enable_pagination,this.pagn_starts_on_page=this.publication.pagn_starts_on_page,this.right=this.publication.pagn_right||10,this.bottom=this.publication.pagn_bottom||10},async updatePagination(){this.is_saving=!0;try{const a={enable_pagination:this.enable_pagination,pagn_starts_on_page:this.pagn_starts_on_page,pagn_right:this.right,pagn_bottom:this.bottom};await this.$api.updateMeta({path:this.publication.$path,new_meta:a}),this.edit_mode=!1,this.is_saving=!1}catch(a){this.is_saving=!1,this.edit_mode=!1,this.$alertify.closeLogOnClick(!0).delay(4e3).error(this.$t("couldntbesaved")),this.$alertify.closeLogOnClick(!0).error(a.response.data)}}}};var B=function(){var e=this,t=e._self._c;return t("div",[t("fieldset",[t("legend",{staticClass:"u-label"},[e._v(e._s(e.$t("pagination")))]),t("div",{staticClass:"u-instructions"},[t("small",[e._v(e._s(e.$t("pagination_instructions")))]),e.is_spread?t("small",[e._v(" "+e._s(e.$t("pagination_instructions_spread")))]):e._e()]),t("br"),e.can_edit&&!e.edit_mode?t("EditBtn",{attrs:{is_unfolded:!0},on:{click:e.enableEditMode}}):e._e(),t("br"),t("br"),t("ToggleInput",{attrs:{content:e.enable_pagination,label:e.$t("enable"),disabled:!e.edit_mode},on:{"update:content":function(i){e.enable_pagination=i}}}),t("br"),t("div",{},[t("DLabel",{attrs:{str:e.$t("pagn_starts_on_page")}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.pagn_starts_on_page,expression:"pagn_starts_on_page",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.pagn_starts_on_page},on:{input:function(i){i.target.composing||(e.pagn_starts_on_page=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}})],1),t("br"),t("div",{staticClass:"u-sameRow"},[t("div",{},[t("DLabel",{attrs:{str:e.is_spread?e.$t("distance_to_outside"):e.$t("distance_to_right")}}),t("div",{staticClass:"u-inputGroup"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.right,expression:"right",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.right},on:{input:function(i){i.target.composing||(e.right=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}}),t("span",{staticClass:"u-suffix",domProps:{textContent:e._s(e.unit)}})])],1),t("div",{},[t("DLabel",{attrs:{str:e.$t("distance_to_bottom")}}),t("div",{staticClass:"u-inputGroup"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.bottom,expression:"bottom",modifiers:{number:!0}}],attrs:{type:"number",disabled:!e.edit_mode},domProps:{value:e.bottom},on:{input:function(i){i.target.composing||(e.bottom=e._n(i.target.value))},blur:function(i){return e.$forceUpdate()}}}),t("span",{staticClass:"u-suffix",domProps:{textContent:e._s(e.unit)}})])],1)]),e.edit_mode?t("div",{staticClass:"_footer"},[t("SaveCancelButtons",{staticClass:"_scb",attrs:{is_saving:e.is_saving},on:{save:e.updatePagination,cancel:e.cancel}})],1):e._e()],1)])},O=[],I=_(T,B,O,!1,null,"d5ec9d18");const A=I.exports,E={props:{publication:Object},components:{WidthHeightField:v,SetMargins:z,PaginationOption:A},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_pageSettings"},[t("WidthHeightField",{attrs:{publication:e.publication}}),t("br"),t("ToggleField",{attrs:{label:e.$t("page_spreads"),field_name:"page_spreads",content:e.publication.page_spreads,path:e.publication.$path,can_edit:!0}}),t("br"),t("SetMargins",{attrs:{publication:e.publication,is_spread:e.publication.page_spreads===!0}}),t("br"),t("PaginationOption",{attrs:{publication:e.publication,is_spread:e.publication.page_spreads===!0}})],1)},R=[],L=_(E,N,R,!1,null,"a6299bd3");const F=L.exports,D={props:{label:String,value:Number,page_modules:Array},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{list_all_z_index(){return this.page_modules.map(a=>a.z_index||0)},max_z_index(){return Math.max(...this.list_all_z_index)},min_z_index(){return Math.min(...this.list_all_z_index)}},methods:{moveToBack(){this.$emit("save",this.min_z_index-1)},moveToFront(){this.$emit("save",this.max_z_index+1)}}};var H=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_depthInput"},[e.label?t("DLabel",{attrs:{str:e.label,for:e.label}}):e._e(),t("div",{staticClass:"u-sameRow"},[t("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.value===e.max_z_index},on:{click:e.moveToFront}},[t("b-icon",{attrs:{icon:"front"}}),e._v(" "+e._s(e.$t("move_to_front"))+" ")],1),t("button",{staticClass:"u-button u-button_black",attrs:{type:"button",disabled:e.value===e.min_z_index},on:{click:e.moveToBack}},[t("b-icon",{attrs:{icon:"back"}}),e._v(" "+e._s(e.$t("move_to_back"))+" ")],1)])],1)},V=[],j=_(D,H,V,!1,null,"162ecdfc");const U=j.exports,W={props:{pages:Array,current_page_id:String},components:{},data(){return{page_id_to_move_to:void 0}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{all_pages_in_select(){return this.pages.map((a,e)=>({key:a.id,text:e+1}))}},methods:{setNewPage(a){this.page_id_to_move_to=a},submit(){this.$emit("submit",this.page_id_to_move_to),this.$emit("close")}}};var q=function(){var e=this,t=e._self._c;return t("BaseModal2",{attrs:{title:e.$t("move_to_page")},on:{close:function(i){return e.$emit("close")}}},[t("div",{},[t("SelectField2",{attrs:{value:e.current_page_id,options:e.all_pages_in_select,can_edit:!0,hide_validation:!0},on:{change:e.setNewPage}})],1),t("template",{slot:"footer"},[t("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){return e.$emit("close")}}},[t("b-icon",{attrs:{icon:"x-circle"}}),e._v(" "+e._s(e.$t("cancel"))+" ")],1),t("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"button",autofocus:"",disabled:!e.page_id_to_move_to||e.page_id_to_move_to===e.current_page_id},on:{click:e.submit}},[e._v(" "+e._s(e.$t("move"))+" ")])])],2)},Z=[],J=_(W,q,Z,!1,null,"897dc9dc");const g=J.exports,G={props:{on_click:Object,pages:Array,current_page_id:String,path:String},components:{SelectPage:g},data(){var a,e,t;return{type_of_link:((a=this.on_click)==null?void 0:a.type)||"",content_url:((e=this.on_click)==null?void 0:e.url)||"",content_page_id:((t=this.on_click)==null?void 0:t.page_id)||"",show_page_select:!1,options:[{key:"",label:this.$t("do_nothing")},{key:"url",label:this.$t("open_webpage")},{key:"page",label:this.$t("navigate_to_page")}]}},created(){},mounted(){},beforeDestroy(){},watch:{type_of_link:{handler(a,e){a==="page"&&e!=="page"&&!this.content_page_id&&(this.show_page_select=!0)}}},computed:{selected_page_id(){return this.pages.findIndex(a=>a.id===this.content_page_id)+1},active_page_number(){return this.pages.findIndex(a=>a.id===this.current_page_id)+1},allow_save(){return this.type_of_link==="page"?this.content_page_id.length>0:this.type_of_link==="url"?this.content_url.length>0:this.type_of_link===""}},methods:{linkToPage(a){this.content_page_id=a,this.show_page_select=!1},save(){let a;this.type_of_link==="url"?a={type:this.type_of_link,url:this.content_url}:this.type_of_link==="page"?a={type:this.type_of_link,page_id:this.content_page_id}:a={},this.$emit("save",{on_click:a}),this.$emit("close")}}};var X=function(){var e=this,t=e._self._c;return t("BaseModal2",{attrs:{title:e.$t("on_click")},on:{close:function(i){return e.$emit("close")}}},[t("div",{staticClass:"u-spacingBottom"},[t("RadioCheckboxInput",{attrs:{value:e.type_of_link,options:e.options,can_edit:!0},on:{"update:value":function(i){e.type_of_link=i}}})],1),e.type_of_link==="url"?t("div",{staticClass:"_options"},[t("TextInput",{attrs:{content:e.content_url,input_type:"url",placeholder:e.$t("url_to_open")},on:{"update:content":function(i){e.content_url=i}}})],1):e.type_of_link==="page"?t("div",{staticClass:"_options"},[e._v(" "+e._s(e.$t("page_number"))+" = "),t("b",[e.selected_page_id?[e._v(" "+e._s(e.selected_page_id)+" ")]:[e._v(" "+e._s(e.$t("no_page_selected"))+" ")]],2),t("EditBtn",{attrs:{label_position:"right"},on:{click:function(i){e.show_page_select=!0}}}),e.show_page_select?t("SelectPage",{attrs:{pages:e.pages,current_page_id:e.current_page_id,allow_save:e.allow_save},on:{submit:e.linkToPage,close:function(i){e.show_page_select=!1}}}):e._e()],1):e._e(),t("SaveCancelButtons",{attrs:{slot:"footer"},on:{save:e.save,cancel:function(i){return e.$emit("close")}},slot:"footer"})],1)},Y=[],K=_(G,X,Y,!1,null,"11a3ac03");const Q=K.exports,ee={props:{can_edit:Boolean,pages:Array,spreads:[Boolean,Array],active_page_number:Number,active_spread_index:[Boolean,Number],is_spread:Boolean,page_width:Number,page_height:Number,scale:Number,show_grid:Boolean,snap_to_grid:Boolean,grid_z_index:String,gridstep_in_mm:Number,layout_mode:{type:String,default:"print"},page_color:String,pagination:[Boolean,Object],publication_path:String,page_modules:Array,page_opened_id:String,active_module:[Boolean,Object],display_as_public:Boolean},components:{DepthInput:U,ModuleCreator:$,SelectPage:g,LinkToPageOrURL:Q,ImportFileZone:b},data(){return{show_page_options:!1,show_move_to_page_modal:!1,show_edit_link_modal:!1,show_all_medias:!1,has_editor_toolbar:!1}},created(){},mounted(){this.$eventHub.$on("module.text_editing_enabled",this.displayToolbarAndToolTip),this.$eventHub.$on("module.text_editing_disabled",this.removeToolbar),this.$eventHub.$on("module.open_remove_modal",this.openRemoveModal)},beforeDestroy(){this.$eventHub.$off("module.text_editing_enabled",this.displayToolbarAndToolTip),this.$eventHub.$off("module.text_editing_disabled",this.removeToolbar),this.$eventHub.$off("module.open_remove_modal",this.openRemoveModal)},watch:{},computed:{is_last_page(){return this.active_page_number===this.pages.length-1},module_meta_filename(){return this.active_module?this.active_module.$path.substring(this.active_module.$path.lastIndexOf("/")+1):""},active_module_first_media(){return this.firstMedia(this.active_module)},first_media_ratio(){var a,e;return(e=(a=this.active_module_first_media)==null?void 0:a.$infos)==null?void 0:e.ratio},is_shape(){return this.getModuleType(this.active_module.module_type)==="shape"},unit(){return this.layout_mode==="screen"?"px":"mm"},magnification(){return this.layout_mode==="screen"?1:this.$root.page_magnification},show_caption(){return!(this.active_module.module_type==="text"||this.is_shape)},has_pagination(){return this.active_page_number-this.pagination.pagination_start_on_page>=0},active_page(){return this.pages[this.active_page_number]},hide_pagination(){return this.pages[this.active_page_number].hide_pagination===!0},new_module_meta(){const a=Math.max(...this.page_modules.map(s=>s.z_index||0))+1;let e=this.$root.default_new_module_left,t=this.$root.default_new_module_top;this.$root.set_new_module_offset_left&&(e=(this.$root.set_new_module_offset_left+this.$root.zoom_offset)/this.magnification),this.$root.set_new_module_offset_top&&(t=(this.$root.set_new_module_offset_top+this.$root.zoom_offset)/this.magnification);const i=Math.max(this.$root.default_new_module_width,this.$root.default_new_module_width/this.scale)/this.magnification,n=Math.max(this.$root.default_new_module_height,this.$root.default_new_module_height/this.scale)/this.magnification;return this.gridstep_in_mm,{page_id:this.page_opened_id,x:e,y:t,width:i,height:n,rotation:0,margins:0,opacity:1,outline_width:0,z_index:a}},page_options(){return this.pages.map((a,e)=>{let t=`${this.$t("page")} ${e+1}`;if(this.is_spread&&this.spreads){const i=this.spreads.findIndex(n=>n.find(s=>s&&s.id===a.id));if(i!==-1){const n=i===0?this.$t("cover"):`${this.$t("spread").toLowerCase()} ${i+1}`;t+=` (${n})`}}return{key:e,text:t}})}},methods:{changePage(a){this.pages[a]&&this.$emit("goToPage",this.pages[a].id)},createPageAndOpen(){this.$emit("createPage"),setTimeout(()=>{this.$emit("nextPage")},500)},moveToAnotherPage(a){this.show_move_to_page_modal=!1,this.updateMediaPubliMeta({page_id:a}),this.setActive(!1)},displayToolbarAndToolTip({$toolbar:a,$tooltip:e}){this.has_editor_toolbar=!0,this.$nextTick(()=>{this.$refs.editor_toolbar&&this.$refs.editor_toolbar.append(a),this.$refs.editor_tooltip&&this.$refs.editor_tooltip.append(e)})},removeToolbar(){this.has_editor_toolbar=!1},openRemoveModal(){this.$refs.removeMenu.show_confirm_delete=!0},getPageNumberFromId(a){return this.pages.findIndex(e=>e.id===a)+1},enableModuleEdit({meta_filenames:a}){const e=a.at(-1);setTimeout(()=>{this.$eventHub.$emit(`module.enable_edit.${e}`),this.$eventHub.$emit(`module.panTo.${e}`)},150)},async setSize(a){if(a==="real_size"){const e=this.active_module.width*this.first_media_ratio;await this.updateMediaPubliMeta({height:e})}else a==="full"?await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height,x:0,y:0,rotation:0}):a==="half_left"?await this.updateMediaPubliMeta({width:this.page_width/2,height:this.page_height,x:0,y:0,rotation:0}):a==="half_right"?await this.updateMediaPubliMeta({width:this.page_width/2,height:this.page_height,x:this.page_width/2,y:0,rotation:0}):a==="half_top"?await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height/2,x:0,y:0,rotation:0}):a==="half_bottom"&&await this.updateMediaPubliMeta({width:this.page_width,height:this.page_height/2,x:0,y:this.page_height/2,rotation:0})},changeModulePage(){this.$eventHub.$emit(`module.move.${this.module_meta_filename}`)},duplicateModule(){this.$eventHub.$emit(`module.duplicate.${this.module_meta_filename}`)},removeModule(){this.$eventHub.$emit(`module.remove.${this.module_meta_filename}`),this.$eventHub.$emit("module.setActive",!1)},setActive(a){this.$eventHub.$emit("module.setActive",a),a&&this.$nextTick(()=>{const e=this.getFilename(a);this.$eventHub.$emit(`module.panTo.${e}`)})},async updateMediaPubliMeta(a){this.active_module&&await this.$api.updateMeta({path:this.active_module.$path,new_meta:a}).catch(e=>{throw this.$alertify.delay(4e3).error(e),e})}}};var te=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_pageMenu"},[t("div",{staticClass:"_pageMenu--pane"},[t("div",{staticClass:"_titleRow"},[t("SelectField2",{attrs:{value:e.active_page_number,options:e.page_options,can_edit:!0,hide_validation:!0,with_arrows:!0},on:{change:e.changePage}})],1),e.is_last_page?t("div",{staticClass:"u-spacingBottom"},[t("div",{staticClass:"u-instructions"},[e._v(" "+e._s(e.$t("last_page_reached"))+" ")]),e.can_edit?t("button",{staticClass:"u-button u-button_bleuvert u-button_small",attrs:{type:"button"},on:{click:e.createPageAndOpen}},[t("b-icon",{attrs:{icon:"plus-square"}}),e._v(" "+e._s(e.$t("create_page"))+" ")],1):e._e(),t("hr")]):e._e(),t("div",{staticClass:"_scale"},[t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{can_toggle:!1,label:e.$t("scale"),value:Math.round(e.scale*100),min:10,max:200,step:1,ticks:[10,25,50,100,200],default_value:100,suffix:"%"},on:{save:function(i){return e.$emit("update:scale",i/100)}}})],1),e.can_edit?t("div",{staticClass:"u-displayAsPublic"},[t("ToggleInput",{attrs:{content:e.display_as_public,label:e.$t("preview")},on:{"update:content":function(i){return e.$emit("update:display_as_public",i)}}})],1):e._e()]),e.can_edit&&!e.display_as_public?[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.has_editor_toolbar&&!e.active_module,expression:"!has_editor_toolbar && !active_module"}],key:e.active_page_number,staticClass:"_pageMenu--pane"},[t("div",{},[t("DLabel",{attrs:{str:e.$t("add_on_page")}}),t("ModuleCreator",{attrs:{publication_path:e.publication_path,pre_addtl_meta:e.new_module_meta,context:"page_by_page",start_collapsed:!1,enable_clipboard_paste:!0},on:{addModules:e.enableModuleEdit}})],1),e.can_edit&&!e.active_module?[t("div",{staticClass:"u-spacingBottom"}),t("div",{},[e.can_edit?t("ToggledSection",{staticClass:"u-spacingBottom",attrs:{label:e.$t("show_grid"),show_toggle:e.show_grid},on:{"update:show_toggle":function(i){return e.$emit("update:show_grid",i)}}},[t("RadioCheckboxInput",{attrs:{value:e.grid_z_index,options:[{label:e.$t("over"),key:"over"},{label:e.$t("under"),key:"under"}],can_edit:!0},on:{"update:value":function(i){return e.$emit("update:grid_z_index",i)}}}),t("div",{staticClass:"u-spacingBottom"}),t("RangeValueInput",{attrs:{label:e.$t("gridstep"),can_toggle:!1,value:e.gridstep_in_mm,min:1,max:20,step:1,ticks:[5,10,20,50],default_value:10,suffix:e.unit},on:{save:function(i){return e.$emit("update:gridstep_in_mm",i)}}}),t("div",{staticClass:"u-spacingBottom"}),t("ToggleInput",{staticClass:"u-spacingBottom",attrs:{content:e.snap_to_grid,label:e.$t("snap_to_grid")},on:{"update:content":function(i){return e.$emit("update:snap_to_grid",i)}}})],1):e._e()],1),t("div",{},[t("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("page_color"),value:e.page_color},on:{save:function(i){return e.$emit("updatePageOptions",{page_number:e.active_page_number,value:{page_color:i}})}}}),t("DLabel",{attrs:{str:e.$t("format,margins,pagination")}}),t("div",{},[t("button",{staticClass:"u-button",attrs:{type:"button"},on:{click:function(i){return e.$eventHub.$emit("publication.settings.toggle")}}},[t("b-icon",{attrs:{slot:"prefix",icon:"gear","aria-label":e.$t("settings")},slot:"prefix"}),e._v(" "+e._s(e.$t("settings"))+" ")],1)]),e.has_pagination?[t("div",{staticClass:"u-spacingBottom"}),t("ToggleInput",{attrs:{content:e.hide_pagination,label:e.$t("hide_pagination")},on:{"update:content":function(i){return e.$emit("updatePageOptions",{page_number:e.active_page_number,value:{hide_pagination:i}})}}})]:e._e()],2)]:e._e()],2),!e.has_editor_toolbar&&!e.active_module?t("div",{staticClass:"_pageMenu--pane"},[t("DetailsPane",{attrs:{header:e.$t("on_this_page"),icon:"images",has_items:e.page_modules.length,is_open_initially:!1,can_be_toggled:!0}},[t("div",{staticClass:"_mediaList"},e._l(e.page_modules,function(i){return t("div",{key:i.$path,staticClass:"u-sameRow",on:{click:function(n){return e.setActive(i.$path)}}},[e.getModuleType(i.module_type)==="shape"?[e._v(" "+e._s(e.$t(i.module_type))+" ")]:e.firstMedia(i)?t("MediaContent",{staticClass:"_preview",attrs:{file:e.firstMedia(i),resolution:50,context:"preview"}}):[e._v(" – ")]],2)}),0)])],1):e._e(),!e.has_editor_toolbar&&e.active_module?t("div",{key:"media-"+e.active_module.$path,staticClass:"_pageMenu--pane"},[t("DLabel",{attrs:{str:e.$t("media"),instructions:e.$t("active_media_instr")}}),e.active_module.module_type==="mosaic"&&e.active_module_first_media?t("MediaContent",{staticClass:"_activeModulePreview",attrs:{file:e.active_module_first_media,resolution:50,context:"preview"}}):e.active_module.module_type==="text"&&e.active_module_first_media?t("span",{staticClass:"u-textEllipsis u-textEllipsis_3 _textExtract"},[t("CollaborativeEditor3",{ref:"textBloc",attrs:{path:e.active_module_first_media.$path,content:e.active_module_first_media.$content,can_edit:!1}})],1):t("span",[e._v(" "+e._s(e.$t(e.active_module.module_type))+" ")]),t("div",{staticClass:"u-spacingBottom"}),t("div",{staticClass:"u-mediaOptions"},[t("div",[t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){e.show_move_to_page_modal=!0}}},[t("b-icon",{attrs:{icon:"arrow-left-right"}}),e._v(" "+e._s(e.$t("move_to_page"))+" ")],1)]),e.show_move_to_page_modal?t("SelectPage",{attrs:{pages:e.pages,current_page_id:e.active_page.id},on:{submit:e.moveToAnotherPage,close:function(i){e.show_move_to_page_modal=!1}}}):e._e(),t("div",{},[t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:e.duplicateModule}},[t("b-icon",{attrs:{icon:"file-plus"}}),e._v(" "+e._s(e.$t("duplicate"))+" ")],1)]),t("div",{},[e.active_module.locked===!0?t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return e.updateMediaPubliMeta({locked:!1})}}},[t("b-icon",{attrs:{icon:"unlock"}}),e._v(" "+e._s(e.$t("unlock"))+" ")],1):t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return e.updateMediaPubliMeta({locked:!0})}}},[t("b-icon",{attrs:{icon:"lock"}}),e._v(" "+e._s(e.$t("lock"))+" ")],1)]),t("div",{},[t("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(i){return e.setActive(!1)}}},[t("b-icon",{attrs:{icon:"dash-square-dotted"}}),e._v(" "+e._s(e.$t("unselect"))+" ")],1)]),t("RemoveMenu",{ref:"removeMenu",attrs:{modal_title:e.$t("withdraw_from_page")},on:{remove:e.removeModule}})],1),t("div",{staticClass:"u-spacingBottom"}),e.show_caption?[t("TitleField",{attrs:{label:e.active_module.caption?e.$t("caption"):e.$t("add_caption"),field_name:"caption",input_type:"editor",custom_formats:["bold","italic","link","emoji"],content:e.active_module.caption,path:e.active_module.$path,maxlength:640,can_edit:e.can_edit}}),e.active_module_first_media&&e.active_module_first_media.caption&&!e.active_module.caption?t("div",{},[t("div",{staticClass:"u-instructions"},[e._v(" "+e._s(e.$t("copy_first_media_caption"))+" ")]),t("button",{staticClass:"u-buttonLink _firstMediaCaption",attrs:{type:"button"},domProps:{innerHTML:e._s(e.$sanitize(e.active_module_first_media.caption))},on:{click:function(i){return e.updateMediaPubliMeta({caption:e.active_module_first_media.caption})}}})]):e._e(),t("div",{staticClass:"u-spacingBottom"})]:e._e(),t("div",[t("DLabel",{attrs:{str:e.$t("on_click")}}),t("div",[e.active_module.on_click&&e.active_module.on_click.type==="url"&&e.active_module.on_click.url?[e._v(" "+e._s(e.$t("open_webpage"))+" "),t("br"),t("b",[e._v(e._s(e.active_module.on_click.url))])]:e.active_module.on_click&&e.active_module.on_click.type==="page"&&e.active_module.on_click.page_id?[e._v(" "+e._s(e.$t("navigate_to_page"))+" "),t("br"),t("b",[e._v(e._s(e.getPageNumberFromId(e.active_module.on_click.page_id)))])]:[e._v(" "+e._s(e.$t("do_nothing"))+" ")],t("EditBtn",{attrs:{label_position:"left"},on:{click:function(i){e.show_edit_link_modal=!0}}})],2),e.show_edit_link_modal?t("LinkToPageOrURL",{attrs:{path:e.active_module.$path,on_click:e.active_module.on_click,pages:e.pages,current_page_id:e.active_page.id},on:{save:e.updateMediaPubliMeta,close:function(i){e.show_edit_link_modal=!1}}}):e._e()],1),t("div",{staticClass:"u-spacingBottom"}),t("div",{staticClass:"u-sameRow"},[t("NumberInput",{attrs:{label:e.$t("position")+" →",value:e.active_module.x,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({x:i})}}}),t("NumberInput",{attrs:{label:e.$t("position")+" ↓",value:e.active_module.y,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({y:i})}}})],1),t("div",{staticClass:"u-sameRow"},[t("NumberInput",{attrs:{label:e.$t("width")+" ↔",value:e.active_module.width,min:0,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({width:i})}}}),t("NumberInput",{attrs:{label:e.$t("height")+" ↕",value:e.active_module.height,min:0,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({height:i})}}})],1),t("div",{staticClass:"_setSizeBtn"},[e.first_media_ratio?t("button",{staticClass:"u-button_icon",attrs:{type:"button",title:e.$t("real_size")},on:{click:function(i){return e.setSize("real_size")}}},[t("b-icon",{attrs:{icon:"slash-square-fill",rotate:"90","aria-label":e.$t("real_size")}})],1):e._e(),t("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(i){return e.setSize("full")}}},[t("b-icon",{attrs:{icon:"square-fill","aria-label":e.$t("full_page")}})],1),t("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(i){return e.setSize("half_left")}}},[t("b-icon",{attrs:{icon:"square-half"}})],1),t("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(i){return e.setSize("half_right")}}},[t("b-icon",{attrs:{icon:"square-half",rotate:"180"}})],1),t("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(i){return e.setSize("half_top")}}},[t("b-icon",{attrs:{icon:"square-half",rotate:"90"}})],1),t("button",{staticClass:"u-button_icon",attrs:{type:"button"},on:{click:function(i){return e.setSize("half_bottom")}}},[t("b-icon",{attrs:{icon:"square-half",rotate:"270"}})],1)]),t("div",{staticClass:"u-spacingBottom"}),t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("angle"),value:e.active_module.rotation,min:0,max:360,step:1,ticks:[0,90,180,270,360],default_value:0,suffix:"°"},on:{save:function(i){return e.updateMediaPubliMeta({rotation:i})}}}),t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("margins"),value:e.active_module.margins,min:0,max:50,step:1,default_value:0,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({margins:i})}}}),e.active_module.module_type!=="ellipsis"?t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("border_radius"),value:e.active_module.border_radius,min:0,max:50,step:1,default_value:0,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({border_radius:i})}}}):e._e(),t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("drop_shadow"),value:e.active_module.drop_shadow?e.active_module.drop_shadow*100:void 0,min:0,max:100,step:1,ticks:[0,25,50,75,100],default_value:0,suffix:"%"},on:{save:function(i){return e.updateMediaPubliMeta({drop_shadow:i/100})}}}),t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("opacity"),value:Math.round(e.active_module.opacity*100),min:1,max:100,step:1,ticks:[1,25,50,75,100],default_value:100,suffix:"%"},on:{save:function(i){return e.updateMediaPubliMeta({opacity:i/100})}}}),t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("blur"),value:e.active_module.blur||0,min:0,max:10,step:.5,ticks:[0,1,2,3,4,5,6,7,8,9,10],default_value:0,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({blur:i})}}}),t("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("background_color"),value:e.active_module.background_color,allow_transparent:!0,default_value:e.is_shape?"transparent":""},on:{save:function(i){return e.updateMediaPubliMeta({background_color:i})}}}),t("RangeValueInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("outline_width"),value:e.active_module.outline_width,min:0,max:20,step:1,ticks:[0,5,10,15,20],default_value:0,suffix:e.unit},on:{save:function(i){return e.updateMediaPubliMeta({outline_width:i})}}}),e.active_module.outline_width>0?t("ColorInput",{staticClass:"u-spacingBottom",attrs:{label:e.$t("outline_color"),value:e.active_module.outline_color,allow_transparent:!0,default_value:"#000000"},on:{save:function(i){return e.updateMediaPubliMeta({outline_color:i})}}}):e._e(),e.active_module_first_media&&e.active_module_first_media.$type==="image"?t("ToggleInput",{staticClass:"u-spacingBottom",attrs:{content:e.active_module.show_fs_button,label:e.$t("show_fs_button")},on:{"update:content":function(i){return e.updateMediaPubliMeta({show_fs_button:i})}}}):e._e(),t("DepthInput",{attrs:{label:e.$t("z_index"),value:e.active_module.z_index,page_modules:e.page_modules},on:{save:function(i){return e.updateMediaPubliMeta({z_index:i})}}})],2):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.has_editor_toolbar,expression:"has_editor_toolbar"}],key:"text-toolbar-"+e.active_page_number,staticClass:"_pageMenu--pane"},[t("div",{ref:"editor_toolbar",staticClass:"_editorToolbar"}),t("div",{ref:"editor_tooltip",staticClass:"_editorToolbar"})])]:e._e()],2)},ie=[],ae=_(ee,te,ie,!1,null,"0f21b9a8");const se=ae.exports;var l=function(){return l=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},l.apply(this,arguments)},m={};w.forEach(function(a){m[a]=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return(e=this.infiniteViewer)[a].apply(e,t)}});var ne={name:"infinite-viewer",methods:m,props:d,mounted:function(){var a=this,e={},t=this.$props;d.forEach(function(s){var o=t[s];c(o)||(e[s]=t[s])});var i=this.$refs;this.infiniteViewer=new y(i.containerElement,i.scrollAreaElement.nextElementSibling,l(l({},e),{wrapperElement:i.wrapperElement,scrollAreaElement:i.scrollAreaElement,horizontalScrollElement:i.horizontalScrollElement,verticalScrollElement:i.verticalScrollElement}));var n=this.infiniteViewer;P.forEach(function(s){n.on(s,function(o){a.$emit(s,l({},o))})})},updated:function(){var a=this.$props,e=this.infiniteViewer;x.forEach(function(t){var i=a[t];e[t]!==i&&!c(i)&&(e[t]=a[t])})},beforeDestroy:function(){this.infiniteViewer.destroy()}};function oe(a,e,t,i,n,s,o,r,Ee,Ne){const u=typeof t=="function"?t.options:t;return a&&a.render&&(u.render=a.render,u.staticRenderFns=a.staticRenderFns,u._compiled=!0),t}const re=ne;var h=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{ref:"containerElement"},[t("div",{ref:"wrapperElement"},[t("div",{ref:"scrollAreaElement"}),a._v(" "),a._t("default")],2),a._v(" "),t("div",{ref:"horizontalScrollElement"},[t("div",{staticClass:"infinite-viewer-scroll-thumb"})]),a._v(" "),t("div",{ref:"verticalScrollElement"},[t("div",{staticClass:"infinite-viewer-scroll-thumb"})])])},_e=[];h._withStripped=!0;const le=void 0,ue=oe({render:h,staticRenderFns:_e},le,re),de={props:{scale:Number,contentWidth:Number,contentHeight:Number,magnification:Number},components:{VueInfiniteViewer:ue},data(){return{viewerOptions:{},scroll_left:void 0,scroll_top:void 0,debounce_zoom:void 0,debounce_scroll:void 0}},created(){},mounted(){this.updateViewerOptions(),this.$nextTick(()=>{this.scrollToCorner({animate:!1})}),this.$eventHub.$on("panzoom.panTo",this.panTo)},beforeDestroy(){this.$eventHub.$off("panzoom.panTo",this.panTo),this.$root.set_new_module_offset_left=0,this.$root.set_new_module_offset_top=0},watch:{scale(){this.updateScale(this.scale),this.updateViewerOptions()},contentWidth(){this.updateViewerOptions()},contentHeight(){this.updateViewerOptions()},magnification(){this.updateViewerOptions()}},computed:{},methods:{updateViewerOptions(){var i;let a,e;const t=200*this.magnification;if((i=this.$el)!=null&&i.offsetWidth){const n=Math.max(0,this.contentWidth*this.magnification);a=[-t,n];const s=Math.max(0,this.contentHeight*this.magnification);e=[-t,s]}console.log("rangeX",JSON.stringify(a)),console.log("rangeY",JSON.stringify(e)),this.viewerOptions={useMouseDrag:!0,useWheelScroll:!0,useAutoZoom:!0,zoomRange:[.4,10],maxPinchWheel:10,rangeX:a,rangeY:e,displayVerticalScroll:!0,displayHorizontalScroll:!0}},dragStart(a){console.log("dragStart"),a.inputEvent.target.classList.contains("panzoom-exclude")&&a.stop()},dragEnd(a){console.log("dragEnd"),a.isDrag||this.disableActiveModule()},pinchStart(){console.log("pinchStart")},abortPinch(){console.log("abortPinch")},pinch(){this.debounce_zoom&&clearTimeout(this.debounce_zoom),this.debounce_zoom=setTimeout(async()=>{const a=this.$refs.viewer.getZoom();a!==this.scale&&this.$emit("update:scale",a)},500)},panTo({x:a,y:e}){this.scrollToCorner({x:a,y:e,animate:!0})},scrollToCorner({x:a,y:e,animate:t}){const i=t?{duration:200}:void 0,n=80;let s=(a||0)+-(0+n)/this.scale,o=(e||0)+-n/this.scale;this.$refs.viewer.scrollTo(s,o,i)},updateScale(a){a!==this.$refs.viewer.getZoom()&&this.$refs.viewer.setZoom(a,{duration:200,zoomBase:"viewport",zoomOffsetX:this.$root.zoom_offset,zoomOffsetY:this.$root.zoom_offset})},disableActiveModule(){this.$eventHub.$emit("module.setActive",!1)},onScroll(){this.debounce_scroll&&clearTimeout(this.debounce_scroll),this.debounce_scroll=setTimeout(async()=>{this.$root.set_new_module_offset_left=Math.max(0,this.$refs.viewer.getScrollLeft()),this.$root.set_new_module_offset_top=Math.max(0,this.$refs.viewer.getScrollTop())},500)}}};var ce=function(){var e=this,t=e._self._c;return t("vue-infinite-viewer",e._b({ref:"viewer",staticClass:"viewer",on:{scroll:e.onScroll,dragStart:e.dragStart,dragEnd:e.dragEnd,pinchStart:e.pinchStart,abortPinch:e.abortPinch,pinch:e.pinch}},"vue-infinite-viewer",e.viewerOptions,!1),[t("div",{staticClass:"_pzViewport"},[e._t("default")],2)])},pe=[],ge=_(de,ce,pe,!1,null,"1f9737cb");const me=ge.exports,he={props:{page_opened_id:String,publication_path:String,publication_title:String,pages:Array,spreads:[Boolean,Array],modules:Array,is_spread:Boolean,page_width:Number,page_height:Number,layout_mode:String,margins:Object,pagination:[Boolean,Object],can_edit:Boolean},components:{PageMenu:se,SinglePage:p,PanZoom2:me},data(){return{scale:1,page_settings:{show_grid:!1,snap_to_grid:!1,grid_z_index:"under",gridstep_in_mm:10},display_as_public:!1,active_module_path:!1,show_sidebar:!0}},created(){this.$eventHub.$on("module.setActive",this.setActiveModule),document.addEventListener("keydown",this.keyPressed),this.loadSettings(),localStorage.getItem("publication.show_sidebar")==="false"&&(this.show_sidebar=!1)},mounted(){},beforeDestroy(){this.$eventHub.$off("module.setActive",this.setActiveModule),document.removeEventListener("keydown",this.keyPressed)},watch:{page_opened_id(){this.$nextTick(()=>{})},page_settings:{handler(){this.saveSettings()},deep:!0},show_sidebar(){localStorage.setItem("publication.show_sidebar",this.show_sidebar)}},computed:{active_module(){return this.active_module_path?this.modules.find(a=>a.$path===this.active_module_path):!1},active_module_first_media(){return this.firstMedia(this.active_module)},active_module_meta_filename(){return this.active_module.$path.substring(this.active_module.$path.lastIndexOf("/")+1)},active_page_number(){return this.pages.findIndex(a=>a.id===this.page_opened_id)},current_page(){return this.pages.find(a=>a.id===this.page_opened_id)},previous_page(){return this.pages[this.active_page_number-1]},next_page(){return this.pages[this.active_page_number+1]},active_spread(){return this.spreads[this.active_spread_index]},active_spread_index(){return this.is_spread&&this.spreads.findIndex(a=>a.find(e=>e&&e.id===this.page_opened_id))},current_page_magnification(){return this.layout_mode==="screen"?1:this.$root.page_magnification}},methods:{loadSettings(){const a=localStorage.getItem(`publication.page_settings.${this.publication_path}`);a&&(this.page_settings=JSON.parse(a))},saveSettings(){localStorage.setItem(`publication.page_settings.${this.publication_path}`,JSON.stringify(this.page_settings))},keyPressed(a){if(this.$root.modal_is_opened||a.target.tagName.toLowerCase()==="input"||a.target.tagName.toLowerCase()==="textarea"||a.target.className.includes("ql-editor")||a.target.hasAttribute("contenteditable"))return;let e="";(a.key==="Backspace"||a.key==="Delete")&&(e="remove",this.$eventHub.$emit("module.open_remove_modal")),e&&a.preventDefault()},setActiveModule(a){this.active_module_path=a},prevPage(){const a=this.active_page_number-1;this.setPageActive(this.pages[a].id)},nextPage(){const a=this.active_page_number+1;this.setPageActive(this.pages[a].id)},setPageActive(a){this.setActiveModule(!1),this.$emit("togglePage",a)},prevSpread(){const e=this.spreads[this.active_spread_index-1][1].id;this.setPageActive(e)},nextSpread(){const e=this.spreads[this.active_spread_index+1][0].id;this.setPageActive(e)},getCorrectPageNumber(a){return this.pages.findIndex(t=>t.id===a)}}};var fe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_openedPage",class:{"is--editable":e.can_edit&&!e.display_as_public}},[t("div",{staticClass:"_spreadNavigator"},[t("div",{staticClass:"_spreadNavigator--content",on:{click:function(i){return i.target!==i.currentTarget?null:e.setActiveModule(!1)}}},[e.show_sidebar?t("div",{staticClass:"_sideCont"},[t("div",{staticClass:"_content"},[t("PageMenu",{attrs:{can_edit:e.can_edit,pages:e.pages,spreads:e.spreads,active_page_number:e.active_page_number,active_spread_index:e.active_spread_index,is_spread:e.is_spread,page_width:e.page_width,page_height:e.page_height,scale:e.scale,show_grid:e.page_settings.show_grid,snap_to_grid:e.page_settings.snap_to_grid,grid_z_index:e.page_settings.grid_z_index,gridstep_in_mm:e.page_settings.gridstep_in_mm,layout_mode:e.layout_mode,page_color:e.current_page.page_color,pagination:e.pagination,publication_path:e.publication_path,page_opened_id:e.page_opened_id,page_modules:e.getModulesForPage({modules:e.modules,page_id:e.page_opened_id}),active_module:e.active_module,display_as_public:e.display_as_public},on:{"update:show_grid":function(i){return e.$set(e.page_settings,"show_grid",i)},"update:snap_to_grid":function(i){return e.$set(e.page_settings,"snap_to_grid",i)},"update:grid_z_index":function(i){return e.$set(e.page_settings,"grid_z_index",i)},"update:gridstep_in_mm":function(i){return e.$set(e.page_settings,"gridstep_in_mm",i)},"update:display_as_public":function(i){e.display_as_public=i},updatePageOptions:function(i){return e.$emit("updatePageOptions",i)},"update:scale":function(i){e.scale=i},prevPage:function(i){return e.prevPage()},nextPage:function(i){return e.nextPage()},goToPage:function(i){return e.setPageActive(i)},createPage:function(i){return e.$emit("createPage")},close:function(i){return e.setPageActive(!1)}}})],1)]):e._e(),t("div",{staticClass:"_pagePan"},[t("NavOverlay",{attrs:{show_sidebar:e.show_sidebar,can_prev:e.active_page_number>0,can_next:e.active_page_number<e.pages.length-1},on:{"update:show_sidebar":function(i){e.show_sidebar=i},prev:e.prevPage,next:e.nextPage,close:function(i){return e.setPageActive(!1)}}},[t("PanZoom2",{attrs:{scale:e.scale,"content-width":e.page_width,"content-height":e.page_height,magnification:e.current_page_magnification},on:{"update:scale":function(i){e.scale=i}}},[t("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t("div",{key:e.is_spread?"spread-"+JSON.stringify(e.active_spread.map(i=>i.id)):"page-"+e.page_opened_id,staticClass:"_pageCont",on:{click:function(i){return i.target!==i.currentTarget?null:e.setActiveModule(!1)}}},[e.is_spread?e._l(e.active_spread,function(i,n){return t("div",{key:i.id?i.id:n,staticClass:"_spreadNavigator--page",class:{"is--active":i.id===e.page_opened_id}},[i?[t("SinglePage",{attrs:{context:"full",page_modules:e.getModulesForPage({modules:e.modules,page_id:i.id}),page_width:e.page_width,page_height:e.page_height,layout_mode:e.layout_mode,page_color:i.page_color,scale:e.scale,show_grid:e.page_settings.show_grid,snap_to_grid:e.page_settings.snap_to_grid,grid_z_index:e.page_settings.grid_z_index,gridstep_in_mm:e.page_settings.gridstep_in_mm,margins:e.margins,page_number:e.getCorrectPageNumber(i.id),pagination:e.pagination,hide_pagination:e.current_page.hide_pagination===!0,active_module:e.active_module,page_is_left:n===0,can_edit:e.can_edit&&i.id===e.page_opened_id&&!e.display_as_public},on:{close:function(s){return e.setPageActive(!1)}}}),i.id!==e.page_opened_id?[t("button",{staticClass:"_openAdjacentPageBtn",attrs:{type:"button"},on:{mousedown:function(s){return s.target!==s.currentTarget?null:e.setPageActive(i.id)}}})]:e._e()]:t("div",{staticClass:"_noPage"})],2)}):t("SinglePage",{staticClass:"_spreadNavigator--page is--active",attrs:{context:"full",page_modules:e.getModulesForPage({modules:e.modules,page_id:e.page_opened_id}),page_width:e.page_width,page_height:e.page_height,layout_mode:e.layout_mode,page_color:e.current_page.page_color,scale:e.scale,show_grid:e.page_settings.show_grid,snap_to_grid:e.page_settings.snap_to_grid,grid_z_index:e.page_settings.grid_z_index,gridstep_in_mm:e.page_settings.gridstep_in_mm,margins:e.margins,page_number:e.active_page_number,pagination:e.pagination,hide_pagination:e.current_page.hide_pagination===!0,active_module:e.active_module,can_edit:e.can_edit&&!e.display_as_public},on:{close:function(i){return e.setPageActive(!1)}}})],2)])],1)],1)],1)])])])},ve=[],be=_(he,fe,ve,!1,null,"b216a8e0");const $e=be.exports,we={props:{index:Number,number_of_pages:Number,can_edit:Boolean},components:{},data(){return{edit_mode:!1}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}};var ye=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_label"},[t("div",{staticClass:"u-sameRow u-label"},[e._v(" "+e._s(e.$t("page"))+" "),e.edit_mode?[t("select",{domProps:{value:e.index},on:{change:function(i){e.$emit("movePage",{old_position:e.index,new_position:+i.target.value}),e.edit_mode=!1}}},e._l(e.number_of_pages,function(i){return t("option",{key:i-1,domProps:{value:i-1,textContent:e._s(i)}})}),0)]:[e._v(" "+e._s(e.index+1)+" ")],e.can_edit?t("EditBtn",{on:{click:function(i){e.edit_mode=!e.edit_mode}}}):e._e()],2),e.edit_mode?t("div",{staticClass:"u-sameRow"},[t("div",{},[t("EditBtn",{attrs:{btn_type:"duplicate"},on:{click:function(i){e.$emit("duplicatePage"),e.edit_mode=!1}}})],1),e.can_edit?t("RemoveMenu",{attrs:{modal_title:e.$t("remove_page_and_content")},on:{remove:function(i){return e.$emit("removePage")}}},[t("template",{slot:"trigger"},[t("EditBtn",{attrs:{btn_type:"remove"}})],1)],2):e._e()],1):e._e()])},Pe=[],xe=_(we,ye,Pe,!1,null,"04815a5b");const Ce=xe.exports,Me={props:{publication:Object,page_opened_id:String,can_edit:Boolean},components:{SinglePage:p,OpenedPageOrSpread:$e,PageLabel:Ce},provide(){return{$getMetaFilenamesAlreadyPresent:()=>this.meta_filenames_already_present}},data(){return{is_creating_page:!1,previews_size:200}},created(){this.$eventHub.$on("publication.togglePage",this.togglePage)},mounted(){},beforeDestroy(){this.$eventHub.$off("publication.togglePage",this.togglePage)},watch:{},computed:{pages(){return this.publication.pages},modules(){return this.publication.$files||[]},is_spread(){return this.publication.page_spreads===!0},page_preview_zoom(){return this.calculateZoomToFit({width:this.publication.page_width,height:this.publication.page_height,desired_largest_dimension:this.previews_size,magnification:this.publication.layout_mode==="screen"?1:this.$root.page_magnification})},spreads(){return this.is_spread?this.makeSpread({pages:this.pages}):!1},margins(){return{left:this.publication.page_margin_left||0,right:this.publication.page_margin_right||0,top:this.publication.page_margin_top||0,bottom:this.publication.page_margin_bottom||0}},pagination(){return this.setPaginationFromPublication(this.publication)},meta_filenames_already_present(){const a=[],e=[];return this.pages.map(t=>{const i=t.id,n=i===this.page_opened_id;this.getModulesForPage({modules:this.modules,page_id:i}).map(o=>{o!=null&&o.source_medias&&Array.isArray(o.source_medias)&&o.source_medias.map(r=>{r.meta_filename_in_project&&(n?a.push(r.meta_filename_in_project):e.push(r.meta_filename_in_project))})})}),[{label:this.$t("on_this_page"),medias:a,color:"var(--c-orange)"},{label:this.$t("on_other_pages"),medias:e,color:"var(--c-bleuvert)"}]}},methods:{getCorrectPageNumber(a){return this.pages.findIndex(t=>t.id===a)},async createPage(a){this.is_creating_page=!0;const e=this.generatePageID();let t=this.publication.pages?this.publication.pages.slice():[];const i={id:e,page_color:"white"};typeof a!="number"?t.push(i):t.splice(a,0,i),await this.updatePubliMeta({pages:t}),await new Promise(n=>setTimeout(n,500)),this.is_creating_page=!1},removePage(a){let e=this.publication.pages.slice();e=e.filter(t=>t.id!==a),this.updatePubliMeta({pages:e})},async duplicatePage(a){let e=this.generatePageID();const t=this.publication.pages.reduce((s,o)=>{if(s.push(o),o.id===a){const r=JSON.parse(JSON.stringify(o));r.id=e,s.push(r)}return s},[]);await this.updatePubliMeta({pages:t});const i=this.getModulesForPage({modules:this.modules,page_id:a});if(i.length===0)return;const n={page_id:e};for(const s of i)await this.duplicateModuleWithSourceMedias({og_module:s,addtl_meta_to_module:n})},movePage({old_position:a,new_position:e}){let t=this.publication.pages.slice();function i(n,s,o){if(o>=n.length)for(var r=o-n.length+1;r--;)n.push(void 0);return n.splice(o,0,n.splice(s,1)[0]),n}i(t,a,e),this.updatePubliMeta({pages:t})},generatePageID(){return(Math.random().toString(36)+"00000000000000000").slice(2,8)},togglePage(a){this.$emit("togglePage",a)},async updatePageOptions({page_number:a,value:e}){let t=this.publication.pages.slice();Object.assign(t[a],e),this.updatePubliMeta({pages:t})},async updatePubliMeta(a){return await this.$api.updateMeta({path:this.publication.$path,new_meta:a})}}};var ke=function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"slideup"}},[e.page_opened_id?t("OpenedPageOrSpread",{key:"openedpage",attrs:{page_opened_id:e.page_opened_id,publication_title:e.publication.title,publication_path:e.publication.$path,pages:e.pages,spreads:e.spreads,modules:e.modules,is_spread:e.is_spread,page_width:e.publication.page_width,page_height:e.publication.page_height,layout_mode:e.publication.layout_mode,margins:e.margins,pagination:e.pagination,can_edit:e.can_edit},on:{togglePage:function(i){return e.$emit("togglePage",i)},updatePageOptions:e.updatePageOptions,createPage:e.createPage}}):t("div",{staticClass:"_pagesList"},[t("div",{staticClass:"_setPreviewSize"},[t("h2",[e.is_spread?[e._v(e._s(e.$t("list_of_spreads")))]:[e._v(e._s(e.$t("list_of_pages")))]],2),t("div",{staticClass:"u-spacingBottom"}),t("RangeValueInput",{attrs:{label:e.$t("previews_size"),value:e.previews_size,can_toggle:!1,min:20,max:600,step:1,ticks:[20,50,100,200,400,600],default_value:200},on:{save:function(i){e.previews_size=i}}})],1),t("transition-group",{key:"allpages",staticClass:"_allPages",attrs:{tag:"div",name:"listComplete"}},[e.is_spread?[e._l(e.spreads,function(i,n){return[e._l(i,function(s,o){return[e.can_edit&&o===0?t("EditBtn",{key:"createPage-"+Math.max(0,n*2+o-1),staticClass:"_createPage",style:e.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;",attrs:{btn_type:"create_page"},on:{click:function(r){e.createPage(Math.max(0,n*2+o-1))}}}):e._e(),t("div",{key:s?s.id:o,attrs:{"data-pageposition":o===0?"left":"right"}},[s&&s.id?[t("div",{staticClass:"_preview"},[t("SinglePage",{attrs:{context:"preview",zoom:e.page_preview_zoom,page_modules:e.getModulesForPage({modules:e.modules,page_id:s.id}),page_width:e.publication.page_width,page_height:e.publication.page_height,layout_mode:e.publication.layout_mode,page_color:s.page_color,page_number:e.getCorrectPageNumber(s.id),pagination:e.pagination,hide_pagination:s.hide_pagination===!0,page_is_left:o===0,can_edit:!1}}),t("button",{staticClass:"u-button _openPage",attrs:{type:"button"},domProps:{innerHTML:e._s(e.$t("open"))},on:{click:function(r){return e.$emit("togglePage",s.id)}}})],1),t("PageLabel",{attrs:{index:n*2+o-1,number_of_pages:e.pages.length,can_edit:e.can_edit},on:{movePage:function(r){return e.movePage({old_position:r.old_position,new_position:r.new_position})},duplicatePage:function(r){return e.duplicatePage(s.id)},removePage:function(r){return e.removePage(s.id)}}})]:e._e()],2)]})]})]:e._l(e.pages,function(i,n){return t("div",{key:"page-"+i.id,staticClass:"u-sameRow _singlePage"},[t("div",{staticClass:"_createPageBtn"},[e.can_edit?t("EditBtn",{key:"createPage"+n,style:e.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;",attrs:{btn_type:"create_page"},on:{click:function(s){return e.createPage(n)}}}):e._e()],1),t("div",{staticClass:"_page"},[t("div",{staticClass:"_preview"},[t("SinglePage",{attrs:{context:"preview",zoom:e.page_preview_zoom,page_modules:e.getModulesForPage({modules:e.modules,page_id:i.id}),page_width:e.publication.page_width,page_height:e.publication.page_height,layout_mode:e.publication.layout_mode,page_color:i.page_color,page_number:e.getCorrectPageNumber(i.id),pagination:e.pagination,hide_pagination:i.hide_pagination===!0,can_edit:!1}}),t("button",{staticClass:"u-button _openPage",attrs:{type:"button"},domProps:{innerHTML:e._s(e.$t("open"))},on:{click:function(s){return e.$emit("togglePage",i.id)}}})],1),t("PageLabel",{staticClass:"_pageLabel",attrs:{index:n,number_of_pages:e.pages.length,can_edit:e.can_edit},on:{movePage:function(s){return e.movePage({old_position:s.old_position,new_position:s.new_position})},duplicatePage:function(s){return e.duplicatePage(i.id)},removePage:function(s){return e.removePage(i.id)}}})],1)])}),e.can_edit?t("span",{key:"createPage",style:e.is_creating_page?"opacity: 0 !important;":"opacity: 1 !important;"},[t("EditBtn",{attrs:{btn_type:"create_page",is_unfolded:!0},on:{click:e.createPage}})],1):e._e()],2)],1)],1)},Se=[],ze=_(Me,ke,Se,!1,null,"70559577");const Te=ze.exports,Be={props:{publication:Object,pane_infos:Object,can_edit:Boolean},components:{PublicationSettings:f,PageSettings:F,PagesList:Te},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{page_opened_id(){return this.pane_infos.page_id}},methods:{}};var Oe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"_pageTemplate"},[t("PagesList",{attrs:{publication:e.publication,page_opened_id:e.page_opened_id,can_edit:e.can_edit},on:{togglePage:function(i){return e.$emit("updatePane",{key:"page_id",value:i})}}}),t("PublicationSettings",[t("PageSettings",{attrs:{publication:e.publication}})],1)],1)},Ie=[],Ae=_(Be,Oe,Ie,!1,null,"6a52712c");const Je=Ae.exports;export{Je as default};
